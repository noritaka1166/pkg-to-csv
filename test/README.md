# pkg-to-csv テストスイート

このディレクトリには、`pkg-to-csv` CLIツールの包括的なテストスイートが含まれています。

## テストファイル

### 1. `unit.test.js` - ユニットテスト
基本的なユーティリティ関数とロジックをテストします。

**テスト内容:**
- package.jsonの基本的な解析
- CSVエスケープ処理
- 依存関係の型判定
- 空の依存関係オブジェクトの処理
- 依存関係が未定義の場合の処理
- パッケージ名が未定義の場合のフォールバック
- バージョン文字列の形式確認

### 2. `index.test.js` - 統合テスト
CLIツールの主要機能をエンドツーエンドでテストします。

**テスト内容:**
- 基本的なpackage.jsonの処理
- `--deps-only` オプション（dependenciesのみ）
- `--dev-only` オプション（devDependenciesのみ）
- 存在しないファイルのエラーハンドリング
- 依存関係がないpackage.jsonの処理
- `--recursive` オプション（再帰的検索）

### 3. `error-handling.test.js` - エラーハンドリングとエッジケース
様々なエラー状況とエッジケースをテストします。

**テスト内容:**
- 不正なJSONファイルの処理
- 読み取り権限のないファイルの処理
- 空のディレクトリの処理
- 非常に大きなpackage.jsonファイルの処理（1000個の依存関係）
- 特殊文字を含むパッケージ名の処理（@types/node、@babel/coreなど）
- カンマを含む説明文のCSVエスケープ
- 循環参照を含むディレクトリ構造（シンボリックリンク）
- 非常に深いディレクトリ構造

### 4. `npm-integration.test.js` - npm レジストリ統合テスト
npmレジストリとの統合機能をテストします。

**テスト内容:**
- `--latest` オプションで最新バージョン情報を取得
- `--license` オプションでライセンス情報を取得
- `--description` オプションで説明を取得
- `--npm-link` オプションでnpmリンクを取得
- 全てのnpmオプションを同時に使用
- 存在しないパッケージのエラーハンドリング
- ネットワークタイムアウトの処理

## テストの実行

### 全てのテストを実行
```bash
npm test
```

### 個別のテストスイートを実行
```bash
# ユニットテストのみ
npm run test:unit

# 統合テストのみ
npm run test:integration

# エラーハンドリングテストのみ
npm run test:error

# npm統合テストのみ
npm run test:npm
```

## テスト統計

- **総テスト数**: 28
- **テストスイート数**: 4
- **成功率**: 100%

## 使用技術

- **テストランナー**: Node.js の組み込み `node:test` モジュール
- **アサーションライブラリ**: Node.js の組み込み `node:assert` モジュール
- **テストタイプ**: ESモジュール形式

## 注意事項

- npm統合テストは実際のnpmレジストリにアクセスするため、ネットワーク接続が必要です
- 一部のテスト（権限テスト、シンボリックリンクテスト）はプラットフォーム依存の場合があります
- 大きなファイルのテストやネットワークテストは実行時間が長くなる場合があります

## テストデータ

テスト実行時に一時的なディレクトリとファイルが作成されますが、各テスト完了後に自動的にクリーンアップされます。

- `test/temp/` - 統合テスト用
- `test/temp-unit/` - ユニットテスト用
- `test/temp-error/` - エラーハンドリングテスト用
- `test/temp-npm/` - npm統合テスト用